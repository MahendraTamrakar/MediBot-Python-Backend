# ─────────────────────────────────────────────────────────────────────────────
# MediBot Docker Compose Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Services:
#   - api: FastAPI backend application
#
# Redis Cloud: Hosted external instance (no container needed)
# MongoDB Atlas: External connection (no container needed)
# ─────────────────────────────────────────────────────────────────────────────

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: medibot-api
    restart: unless-stopped
    ports:
      - "8000:8000"
    env_file:
      - .env
    volumes:
      # Persist FAISS indexes
      - faiss_data:/app/faiss_store
      # Mount Firebase service account (read-only)
      - ./firebase-service-account.json:/app/firebase-service-account.json:ro
    networks:
      - medibot-network
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  faiss_data:
    driver: local

networks:
  medibot-network:
    driver: bridge
